---
title: "Graphs"
author: <a href="https://schuyler-smith.github.io/" target="_blank" >Schuyler D. Smith</a>
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

```{r load_data, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(fig.width=16, fig.height=8, cache = TRUE)
library(phylosmith)
data(soil_column)
derep_sc <- conglomerate_samples(soil_column, treatment = c('Matrix', 'Treatment'), merge_on = 'Day')
```

<br>

## abundance_heatmap
<a name="abundance_heatmap"></a>

Create a ggplot object heatmap of abundances of each taxa for each sample.

<br>
***Usage***
```r
abundance_heatmap(phyloseq_obj, classification = NULL, treatment, subset = NULL, transformation = 'none', colors = 'default')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`treatment` | Column name as a `string` or `numeric` in the `sample_data`. This can be a `vector` of multiple columns and they will be combined into a new column.
`subset` | A factor within the `treatment`. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`classification` | Column name as a `string` or `numeric` in the `tax_table` for the factor to use for node colors.
`transformation` | Transformation to be used on the data. "none", "relative_abundance", "log", "log10", "log1p", "log2", "asn", "atanh", "boxcox", "exp", "identity", "logit", "probability", "probit", "reciprocal", "reverse" and "sqrt".
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.

***Examples***
```{r abundance_heatmap}
abundance_heatmap(derep_sc, classification = 'Phylum', treatment = c('Matrix', 'Treatment'), subset = 'Soil', transformation = 'log10')
```

<br>

***

<br>

## abundance_lines
<a name="abundance_lines"></a>

Create a ggplot object line graph of abundances across samples

<br>
***Usage***
```r
abundance_lines(phyloseq_obj, classification, treatment, subset = NULL, relative_abundance = FALSE, points = TRUE, colors = 'default')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`classification` | Column name as a `string` or `numeric` in the `tax_table` for the factor to use for node colors.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`subset` | A factor within the `treatment`. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`relative_abundance` | If `TRUE`, transforms the abundance data into relative abundance by sample.
`points` | Whether or not to display point on the lines for each data-point.
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.

***Examples***
```{r abundance_lines}
abundance_lines(derep_sc, classification = 'Phylum', treatment = c('Matrix', 'Treatment'), subset = 'Soil', relative_abundance = TRUE)
```

<br>

***

<br>

## co_occurrence_network
<a name="co_occurrence_network"></a>

Create a ggplot object of the co-occurrence network.

<br>
***Usage***
```r
co_occurrence_network(phyloseq_obj, treatment = NULL, subset = NULL, co_occurrence_table = NULL, classification = NULL, node_colors = 'default', cluster = FALSE, cluster_colors = 'default', buffer = 0.5)
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`subset` | A factor within the treatment. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`co_occurrence_table` | Table of the co-occurrence of taxa/genes in the phyloseq_obj, computed using `co_occurrence()`. If no table is given, it will be computed with the phyloseq_obj, using the given treatment and p = 0.05 with a rho cut-off of 0.8.
`classification` | Column name as a `string` or `numeric` in the `tax_table` for the factor to use for node colors.
`node_colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.
`cluster` |  if `TRUE`, will use `igraph`'s `cluster_fast_greedy` method. Alternatively, you may pass a vector of cluster assignments with order corresponding to the order of the taxa_names in the `phyloseq_obj`.
`cluster_colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.
`buffer` | Amount of space beyond the points to extend the cluster (aesthetic argument).

***Examples***
```{r co_occurrence_network}
co_occurrence_network(soil_column, treatment = c('Matrix', 'Treatment'), subset = 'Soil Amended', co_occurrence_table = NULL, classification = 'Phylum')
```

<br>

***

<br>

## network_layout_ps
<a name="network_layout_ps"></a>

Create an layout_igraph object of the co-occurrence from a phyloseq object. This can be input into the co_occurrence_network function, or used for other network creating scripts. The purpose is to be able to create reproducible and comparable graphics.

<br>
***Usage***
```r
network_layout_ps(phyloseq_obj, classification = NULL, treatment = NULL, subset = NULL, co_occurrence_table = NULL, algorithm = 'fr')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`subset` | A factor within the treatment. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`co_occurrence_table` | Table of the co-occurrence of taxa/genes in the phyloseq_obj, computed using `co_occurrence()`. If no table is given, it will be computed with the phyloseq_obj, using the given treatment and p = 0.05 with a rho cut-off of 0.8.
`classification` | Column name as a `string` or `numeric` in the `tax_table` for the factor to use for node colors.
`algorithm` | Supported `igraph::layout_` algorithm.

***Examples***
```{r network_layout_ps}
network_layout_ps(soil_column, treatment = c('Matrix', 'Treatment'), subset = 'Soil Amended', algorithm = 'kk')
```

<br>

***

<br>

## nmds_phyloseq
<a name="nmds_phyloseq"></a>

Creates a ggplot object of the NMDS ordination of samples.

<br>
***Usage***
```r
nmds_phyloseq(phyloseq_obj, treatment, circle = TRUE, labels = FALSE, colors = 'default', verbose = TRUE)
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`circle` | Whether to add a stat_elipse around eache treatment factor on the graph.
`labels` | Column name as a `string` or `numeric` in the sample_data to use to place labels of that factor instead of circle points.
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.
`verbose` | Whether or not to print the `vegan::metaMDS` stress convergence to console (TRUE) or not (FALSE).

***Examples***

```{r nmds_phyloseq}
nmds_phyloseq(soil_column, c('Matrix', 'Treatment'), circle = TRUE, verbose = FALSE)
```

<br>

***

<br>

## phylogeny_profile
<a name="phylogeny_profile"></a>

Creates a ggplot object of the stacked bar plots of a classification level in the tax_data, for each sample. 

<br>
***Usage***
```r
phylogeny_profile(phyloseq_obj, classification, treatment, subset = NULL, merge = TRUE, relative_abundance = FALSE, colors = 'default')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`classification` | Column name as a `string` or `numeric` in the `tax_table` for the factor to use for node colors.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`subset` | A factor within the treatment. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`merge` | If `FALSE`, will show separation of individuals within each `classification`.
`relative_abundance` | If `TRUE`, transforms the abundance data into relative abundance by sample.
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.

***Examples***

```{r phylogeny_profile}
phylogeny_profile(derep_sc, classification = 'Phylum', treatment = c('Matrix', 'Treatment'), subset = 'Soil', merge = TRUE, relative_abundance = TRUE)
```

<br>

***

<br>

## taxa_abundance_bars
<a name="taxa_abundance_bars"></a>

Creates a ggplot object of the side-by-side bar plots of a classification level in the tax_data. 

<br>
***Usage***
```r
taxa_abundance_bars(phyloseq_obj, classification = NULL, treatment, subset = NULL, transformation = 'none', colors = 'default')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain tax_table() with information about each taxa/gene.
`classification` | Column name as a `string` or `numeric` in the `tax_table` for the factor to use for node colors.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`subset` | A factor within the `treatment`. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`transformation` | Transformation to be used on the data. "none", "mean", "median", "sd", "log", "log10"
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.

***Examples***

```{r taxa_abundance_bars}
taxa_abundance_bars(taxa_filter(soil_column, frequency = 0.8), classification = 'Phylum', treatment = c('Matrix', 'Treatment'), subset = 'Unamended', transformation = 'mean')
```

<br>

***

<br>

## taxa_core_graph
<a name="taxa_core_graph"></a>

Create graph of the core taxa seen in phyloseq-object over a range of abundance and smaple-frequency values.

<br>
***Usage***
```r
taxa_core_graph(phyloseq_obj, treatment = NULL, subset = NULL, frequencies = seq(0.1, 1, 0.1), abundance_thresholds = seq(0.01, 1, 0.01), colors = 'default')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain tax_table() with information about each taxa/gene.
`treatment` | Column name as a `string` or `numeric` in the sample_data. This can be a vector of multiple columns and they will be combined into a new column.
`subset` | A factor within the `treatment`. This will remove any samples that to not contain this factor. This can be a vector of multiple factors to subset on.
`frequencies` | The range of proportions of samples the taxa are found in.
`abundance_thresholds` | The range of minimum relative abundances the taxa are found in for each sample.
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.

***Examples***

```{r taxa_core_graph}
taxa_core_graph(soil_column, abundance_thresholds = seq(0.01, 0.25, 0.01))
```
<br>

***

<br>

## tsne_phyloseq
<a name="tsne_phyloseq"></a>

Creates a ggplot object of the t-SNE ordination of the samples. t-Distributed Tochastic Neighbor Embedding is a machine learning algorithm of nonlinear dimensionality reduction for high-dimensional data.

<br>
***Usage***
```r
tsne_phyloseq(phyloseq_obj, treatment, perplexity = 10, circle = TRUE, labels = FALSE, colors = 'default')
```

<br>
***Arguments***

Call | Description
-------------------- | ------------------------------------------------------------
`phyloseq_obj` | A phyloseq-class object. It must contain `sample_data` with information about each sample, and it must contain `tax_table` with information about each taxa/gene.
`treatment` | Column name as a `string` or `numeric` in the `sample_data`. This can be a `vector` of multiple columns and they will be combined into a new column.
`perplexity` | similar to selecting the number of neighbors to consider in decision making (should not be bigger than 3 * perplexity < nrow(X) - 1, see Rtsne for interpretation)
`circle` | Whether to add a `stat_elipse` around each `treatment` factor on the graph.
`labels` | Column name as a `string` or `numeric` in the `sample_data` to use to place labels of that factor instead of circle points.
`colors` | Name of a color set from the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf" target="_blank" >`RColorBrewer`</a> package or a vector palete of R-accepted colors.

***Examples***

```{r tsne_phyloseq}
tsne_phyloseq(soil_column, treatment = c('Matrix', 'Treatment'), perplexity = 10)
```

<br>

***

<br>
